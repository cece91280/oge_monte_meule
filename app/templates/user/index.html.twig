{% extends 'base.html.twig' %}

{% block title %}Mon compte{% endblock %}

{% block body %}
    {% include 'partials/_header.html.twig' %}

    <section class="profile-wrapper">
        <div class="profile-card">
            <h2 class="section-title">Profil</h2>
            <ul class="info-list">
                <li><strong>Nom :</strong> {{ users.nom }}</li>
                <li><strong>Prénom :</strong> {{ users.prenom }}</li>
                <li><strong>Email :</strong> {{ users.email }}</li>
                <li><strong>Téléphone :</strong> {{ users.telephone }}</li>
            </ul>
            <div class="box">
                <h2 class="section-title">Vos devis :</h2>

                {% if devis is empty %}
                    <p>Vous n'avez pas encore de devis</p>
                {% else %}
                    <table class="devis-table">
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Volume</th>
                            <th>Status</th>
                            <th>Prix</th>
                            <th>Avis</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for d in devis %}
                            <tr>
                                <td>{{ d.devis.dateDemenagement|date('d/m/y') }}</td>
                                <td>{{ d.devis.volume }} m²</td>
                                <td>{{ d.statut }}</td>
                                <td>{{ d.devis.prixEstime }} €</td>
                                <td>
                                    {% if d.avis is not empty %}
                                        {% for avis in d.avis %}
                                            {% if avis.users == app.user %}
                                                <strong>{{ avis.note }}/5</strong><br>
                                                <em>{{ avis.commentaire }}</em>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>

                            {% if d.avis is empty and d.avisForm is defined and d.avisForm is not null %}
                                <tr class="avis-row">
                                    <td colspan="5">
                                        {{ form_start(d.avisForm, {'attr': {'class': 'avis-form'}}) }}
                                        <div class="form-group">
                                            <h3>Laissez un commentaire :</h3>
                                            <div class="radio-options">
                                                {{ form_widget(d.avisForm.note) }}
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="{{ d.avisForm.commentaire.vars.id }}">Votre commentaire</label>
                                            {{ form_widget(d.avisForm.commentaire) }}
                                        </div>
                                        <button type="submit">Envoyer</button>
                                        {{ form_end(d.avisForm) }}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
        </div>
    </section>

    {% include 'partials/_footer.html.twig' %}
{% endblock %}
